name: üöÄ M√ÅY CH·ª¶ PREMIUM C·ª¶A HEROGOODBOYVN üöÄ

on:
  workflow_dispatch:
    inputs:
      run_hours:
        description: 'Ch·ªçn th·ªùi gian ch·∫°y (1-6 gi·ªù)'
        required: true
        type: choice
        options: ['1', '2', '3', '4', '5', '6']
        default: '3'

jobs:
  rdp:
    runs-on: windows-latest
    timeout-minutes: 390

    steps:
      - name: T·∫£i Ngrok
        run: |
          Invoke-WebRequest https://bin.equinox.io/c/bNyj1mQVY4c/ngrok-v3-stable-windows-amd64.zip -OutFile ngrok.zip
          Expand-Archive ngrok.zip -DestinationPath .
          .\ngrok.exe authtoken ${{ secrets.NGROK_AUTH_TOKEN }}

      - name: B·∫≠t RDP + User + T·ªëi ∆Øu
        run: |
          Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server' -Name "fDenyTSConnections" -Value 0
          Enable-NetFirewallRule -DisplayGroup "Remote Desktop"

          net user HEROGOODBOYVN ${{ secrets.RDP_PASSWORD || 'Nguyen2009' }} /add
          net localgroup administrators HEROGOODBOYVN /add
          net localgroup "Remote Desktop Users" HEROGOODBOYVN /add

          powercfg -setactive SCHEME_MIN

      - name: Tunnel & K·∫øt N·ªëi
        run: |
          Start-Process -WindowStyle Hidden -FilePath ".\ngrok.exe" -ArgumentList "tcp 3389"

          Start-Sleep -Seconds 60

          $addr = ""
          for ($i = 1; $i -le 10; $i++) {
            try {
              $tunnel = Invoke-RestMethod http://localhost:4040/api/tunnels -ErrorAction Stop
              $addr = ($tunnel.tunnels | Where-Object proto -eq "tcp").public_url -replace "tcp://",""
              if ($addr) { break }
            } catch {}
            Start-Sleep -Seconds 30
          }

          if (-not $addr) { Write-Host "L·ªói l·∫•y address - Check token ngrok m·ªõi!" ; exit 1 }

          Write-Host "üöÄ M√ÅY CH·ª¶ PREMIUM S·∫¥N S√ÄNG üöÄ"
          Write-Host "Th·ªùi gian ch·∫°y: ${{ inputs.run_hours }} gi·ªù"
          Write-Host ""
          Write-Host "K·∫æT N·ªêI RDP:"
          Write-Host "$addr"
          Write-Host ""
          Write-Host "Username: HEROGOODBOYVN"
          Write-Host "Password: Nguyen2009"
          Write-Host ""
          Write-Host "D√πng Remote Desktop (PC/ƒëi·ªán tho·∫°i) ƒë·ªÉ k·∫øt n·ªëi"
          Write-Host "Ch√∫c m·ªçi ng∆∞·ªùi ch∆°i Windows vui v·∫ª! üéâ"

          Start-Sleep -Seconds ${{ inputs.run_hours * 3600 }}
