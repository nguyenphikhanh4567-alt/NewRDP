name: M√ÅY CH·ª¶ PREMIUM C·ª¶A HEROGOODBOYVN

on:
  workflow_dispatch:
    inputs:
      ngrok_download_url:
        description: 'Ngrok download link'
        required: true
        default: 'https://bin.equinox.io/c/bNyj1mQVY4c/ngrok-v3-stable-windows-amd64.zip'

jobs:
  build:
    runs-on: windows-latest
    timeout-minutes: 370  # 6 gi·ªù + d∆∞ ch√∫t
    steps:
      - name: Download ngrok
        run: |
          Invoke-WebRequest -Uri "${{ github.event.inputs.ngrok_download_url }}" -OutFile ngrok.zip
          Expand-Archive ngrok.zip -DestinationPath .

      - name: Auth ngrok
        env:
          NGROK_AUTH_TOKEN: ${{ secrets.NGROK_AUTH_TOKEN }}
        run: .\ngrok.exe authtoken $Env:NGROK_AUTH_TOKEN

      - name: Setup RDP + Max Fast Intro + Reduce Lag
        run: |
          Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server' -Name "fDenyTSConnections" -Value 0
          Enable-NetFirewallRule -DisplayGroup "Remote Desktop"
          New-LocalUser "HEROGOODBOYVN" -Password (ConvertTo-SecureString -AsPlainText "${{ secrets.RDP_PASSWORD || 'Nguyen2009' }}" -Force) -FullName "HEROGOODBOYVN"
          Add-LocalGroupMember -Group "Remote Desktop Users" -Member "HEROGOODBOYVN"
          Add-LocalGroupMember -Group "Administrators" -Member "HEROGOODBOYVN"
          
          # Intro flash nhanh + t·∫Øt hi·ªáu ·ª©ng
          Set-ItemProperty -Path 'HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\VisualEffects' -Name "VisualFXSetting" -Value 2
          Set-ItemProperty -Path 'HKCU:\Control Panel\Desktop\WindowMetrics' -Name "MinAnimate" -Value "0"
          Set-ItemProperty -Path 'HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced' -Name "TaskbarAnimations" -Value 0
          Set-ItemProperty -Path 'HKCU:\Software\Microsoft\Windows\CurrentVersion\Themes\Personalize' -Name "EnableTransparency" -Value 0
          Set-ItemProperty -Path 'HKCU:\Control Panel\Desktop' -Name "DragFullWindows" -Value "0"
          New-Item -Path 'HKCU:\Software\Microsoft\Windows\CurrentVersion\Policies\ActiveDesktop' -Force | Out-Null
          Set-ItemProperty -Path 'HKCU:\Software\Microsoft\Windows\CurrentVersion\Policies\ActiveDesktop' -Name "NoChangingWallPaper" -Value 1
          
          # T·∫Øt services n·∫∑ng
          @("SysMain","WSearch","wuauserv","WinDefend","DiagTrack") | ForEach-Object {
            Stop-Service -Name $_ -Force -ErrorAction SilentlyContinue
            Set-Service -Name $_ -StartupType Disabled -ErrorAction SilentlyContinue
          }
          
          # Gi·∫£m lag RDP t·ªëi ƒëa
          New-Item -Path 'HKLM:\SOFTWARE\Policies\Microsoft\Windows NT\Terminal Services' -Force | Out-Null
          Set-ItemProperty -Path 'HKLM:\SOFTWARE\Policies\Microsoft\Windows NT\Terminal Services' -Name "MaxCompressionLevel" -Value 2 -Type DWord
          Set-ItemProperty -Path 'HKLM:\SOFTWARE\Policies\Microsoft\Windows NT\Terminal Services' -Name "VideoQualityMode" -Value 2 -Type DWord
          Set-ItemProperty -Path 'HKLM:\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp' -Name "fEnableDesktopComposition" -Value 0
          Set-ItemProperty -Path 'HKLM:\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations' -Name "DWMFRAMEINTERVAL" -Value 10 -Type DWord

      - name: Start Ngrok Tunnel (Hidden) & Display RDP Info
        run: |
          Write-Host "üåå‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®üåå" -ForegroundColor Cyan
          Write-Host "   üöÄüî• RDP PREMIUM HEROGOODBOYVN ƒê√É S·∫¥N S√ÄNG! üî•üöÄ   " -ForegroundColor Magenta
          Write-Host "   üëë Intro The Flash + Lag gi·∫£m max level! üëë       " -ForegroundColor Yellow
          Write-Host "üåå‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®üåå" -ForegroundColor Cyan
          Write-Host ""
          Write-Host "   Username: HEROGOODBOYVN"
          Write-Host "   Password: Nguyen2009"
          Write-Host ""
          Write-Host "   ƒêang kh·ªüi ƒë·ªông tunnel ngrok si√™u t·ªëc... (·∫©n c·ª≠a s·ªï)"
          
          Start-Process -WindowStyle Hidden -FilePath ".\ngrok.exe" -ArgumentList "tcp 3389 --log=stdout"
          
          Start-Sleep -Seconds 15
          
          $tunnels = Invoke-RestMethod http://localhost:4040/api/tunnels
          $tcpTunnel = ($tunnels.tunnels | Where-Object { $_.proto -eq "tcp" }).public_url
          $hostPort = $tcpTunnel -replace "tcp://", ""
          
          Write-Host ""
          Write-Host "üåå‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®üåå" -ForegroundColor Cyan
          Write-Host "   üéÆ ƒê·ªäA CH·ªà K·∫æT N·ªêI RDP (copy nguy√™n d√≤ng d∆∞·ªõi): üéÆ   " -ForegroundColor Magenta
          Write-Host "   $hostPort"
          Write-Host "   Host: $($hostPort.split(':')[0]) | Port: $($hostPort.split(':')[1])"
          Write-Host "üåå‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®üåå" -ForegroundColor Cyan
          Write-Host ""
          Write-Host "   Tunnel ch·∫°y ·ªïn ƒë·ªãnh - Job t·ª± d·ª´ng sau 6 gi·ªù."
          Write-Host "   Ch√∫c m·ªçi ng∆∞·ªùi ch∆°i Windows vui v·∫ª! üéâüöÄ"
          Start-Sleep -Seconds 21420
