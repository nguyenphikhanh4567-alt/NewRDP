name: M√ÅY CH·ª¶ PREMIUM C·ª¶A HEROGOODBOYVN

on:
  workflow_dispatch:
    inputs:
      run_hours:
        description: 'Ch·ªçn th·ªùi gian ch·∫°y (1-6 gi·ªù)'
        required: true
        type: choice
        options: ['1', '2', '3', '4', '5', '6']
        default: '3'

jobs:
  premium-rdp:
    runs-on: windows-latest
    timeout-minutes: 390

    steps:
      - name: T·∫£i Ngrok
        run: |
          Invoke-WebRequest https://bin.equinox.io/c/bNyj1mQVY4c/ngrok-v3-stable-windows-amd64.zip -OutFile ngrok.zip
          Expand-Archive ngrok.zip -DestinationPath .
          .\ngrok.exe authtoken ${{ secrets.NGROK_AUTH_TOKEN }}

      - name: B·∫≠t RDP + T·∫°o User + T·ªëi ∆Øu M∆∞·ª£t Max
        run: |
          Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server' -Name "fDenyTSConnections" -Value 0
          Enable-NetFirewallRule -DisplayGroup "Remote Desktop"

          $user = "HEROGOODBOYVN"
          \( pass = " \){{ secrets.RDP_PASSWORD || 'Nguyen2009' }}"

          if (-Not (Get-LocalUser -Name $user -ErrorAction SilentlyContinue)) {
            New-LocalUser -Name $user -Password (ConvertTo-SecureString $pass -AsPlainText -Force) -FullName "HEROGOODBOYVN Premium"
            Add-LocalGroupMember -Group "Administrators" -Member $user
            Add-LocalGroupMember -Group "Remote Desktop Users" -Member $user
          } else {
            Set-LocalUser -Name $user -Password (ConvertTo-SecureString $pass -AsPlainText -Force)
          }

          powercfg -setactive SCHEME_MIN
          Set-ItemProperty -Path 'HKCU:\Software\Microsoft\Windows\CurrentVersion\Themes\Personalize' -Name "EnableTransparency" -Value 0
          Set-ItemProperty -Path 'HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced' -Name "TaskbarAnimations" -Value 0
          Stop-Service SysMain, DiagTrack -Force -ErrorAction SilentlyContinue

      - name: Kh·ªüi ƒê·ªông Tunnel & L·∫•y Address T·ª´ Log (Fix Connection Refused)
        run: |
          # Ch·∫°y ngrok v√† capture log
          Start-Process -RedirectStandardOutput ngrok.log -FilePath ".\ngrok.exe" -ArgumentList "tcp 3389"

          Write-Host "üåå‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®üåå"
          Write-Host "      üî• M√ÅY CH·ª¶ PREMIUM HEROGOODBOYVN ONLINE! üî•      "
          Write-Host "   üëë Th·ªùi gian ch·∫°y: ${{ inputs.run_hours }} gi·ªù si√™u m∆∞·ª£t! üëë   "
          Write-Host "üåå‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®‚ú®üåå"
          Write-Host ""

          Write-Host "   ƒêang ch·ªù tunnel ngrok... (l·∫•y address t·ª´ log, kh√¥ng d√πng API 4040)"

          $addr = ""
          $attempts = 0
          while ($attempts -lt 30) {
            Start-Sleep -Seconds 10
            $log = Get-Content ngrok.log -Tail 20 -ErrorAction SilentlyContinue
            $line = $log | Select-String "started tunnel" | Select-Object -Last 1
            if ($line) {
              $addr = $line.Line -replace ".*addr=","" -replace 'tcp://',""
              break
            }
            $attempts++
          }

          if (-not $addr) {
            Write-Host "L·ªñI: Kh√¥ng l·∫•y ƒë∆∞·ª£c address - Check token ngrok m·ªõi nh·∫•t t·ª´ dashboard.ngrok.com!"
            exit 1
          }

          Write-Host ""
          Write-Host "   üéÆ TH√îNG TIN K·∫æT N·ªêI PREMIUM (copy nguy√™n d√≤ng d∆∞·ªõi): üéÆ"
          Write-Host "   $addr"
          Write-Host ""
          Write-Host "   Username: HEROGOODBOYVN"
          Write-Host "   Password: Nguyen2009"
          Write-Host ""
          Write-Host "   D√πng Microsoft Remote Desktop / Windows App tr√™n ƒëi·ªán tho·∫°i ho·∫∑c PC"
          Write-Host "   N·∫øu c·∫£nh b√°o ch·ª©ng ch·ªâ ‚Üí Nh·∫•n Continue l√† v√†o ngay!"
          Write-Host ""
          Write-Host "        üéâ CH√öC M·ªåI NG∆Ø·ªúI CH∆†I WINDOWS VUI V·∫∫! üéâ"
          Write-Host "                   Powered by HEROGOODBOYVN Premium ‚ú®üöÄ"
          Write-Host ""

          Start-Sleep -Seconds ${{ inputs.run_hours * 3600 }}
