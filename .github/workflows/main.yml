name: üöÄ SERVER HRGBVNGM PREMIUM üöÄ

on:
  workflow_dispatch:
    inputs:
      ngrok_download_url:
        description: 'Ngrok download link'
        required: true
        default: 'https://bin.equinox.io/c/bNyj1mQVY4c/ngrok-v3-stable-windows-amd64.zip'

jobs:
  build:
    runs-on: windows-latest
    timeout-minutes: 370

    steps:
      - name: Download ngrok
        run: |
          Invoke-WebRequest -Uri "${{ inputs.ngrok_download_url }}" -OutFile ngrok.zip
          Expand-Archive ngrok.zip -DestinationPath .

      - name: Auth ngrok
        env:
          NGROK_AUTH_TOKEN: ${{ secrets.NGROK_AUTH_TOKEN }}
        run: |
          if (-Not $Env:NGROK_AUTH_TOKEN) {
            Write-Host "L·ªñI: Ch∆∞a ƒë·∫∑t secret NGROK_AUTH_TOKEN!"
            exit 1
          }
          .\ngrok.exe authtoken $Env:NGROK_AUTH_TOKEN

      - name: Setup RDP + Max Fast Intro + Reduce Lag
        run: |
          # ƒê·ªïi t√™n m√°y ch·ªß h·ª£p l·ªá
          Rename-Computer -NewName "NCDuFlash" -Restart:$false
          Write-Host "ƒê√£ ƒë·ªïi t√™n PC th√†nh: NCDuFlash"

          # B·∫≠t RDP
          Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server' -Name "fDenyTSConnections" -Value 0
          Enable-NetFirewallRule -DisplayGroup "Remote Desktop"

          # T·∫°o/c·∫≠p nh·∫≠t user v·ªõi t√™n ch·ªß Nguy·ªÖn Ch√≠ D·ª±
          $user = "NguyenChiDu"
          $pass = "W1nd0ws-P4ssw0rd-2025!"
          if (-Not (Get-LocalUser -Name $user -ErrorAction SilentlyContinue)) {
            New-LocalUser $user -Password (ConvertTo-SecureString -AsPlainText $pass -Force) -FullName "Nguy·ªÖn Ch√≠ D·ª±"
            Add-LocalGroupMember -Group "Remote Desktop Users" -Member $user
            Add-LocalGroupMember -Group "Administrators" -Member $user
            Write-Host "ƒê√£ t·∫°o user m·ªõi: $user (T√™n ch·ªß: Nguy·ªÖn Ch√≠ D·ª±)"
          } else {
            Set-LocalUser $user -Password (ConvertTo-SecureString -AsPlainText $pass -Force)
            Write-Host "ƒê√£ c·∫≠p nh·∫≠t password cho user: $user"
          }
          
          # Intro flash nhanh + t·∫Øt hi·ªáu ·ª©ng
          Set-ItemProperty -Path 'HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\VisualEffects' -Name "VisualFXSetting" -Value 2
          Set-ItemProperty -Path 'HKCU:\Control Panel\Desktop\WindowMetrics' -Name "MinAnimate" -Value "0"
          Set-ItemProperty -Path 'HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced' -Name "TaskbarAnimations" -Value 0
          Set-ItemProperty -Path 'HKCU:\Software\Microsoft\Windows\CurrentVersion\Themes\Personalize' -Name "EnableTransparency" -Value 0
          Set-ItemProperty -Path 'HKCU:\Control Panel\Desktop' -Name "DragFullWindows" -Value "0"
          New-Item -Path 'HKCU:\Software\Microsoft\Windows\CurrentVersion\Policies\ActiveDesktop' -Force | Out-Null
          Set-ItemProperty -Path 'HKCU:\Software\Microsoft\Windows\CurrentVersion\Policies\ActiveDesktop' -Name "NoChangingWallPaper" -Value 1
          
          # T·∫Øt services n·∫∑ng
          @("SysMain","WSearch","wuauserv","WinDefend","DiagTrack") | ForEach-Object {
            Stop-Service -Name $_ -Force -ErrorAction SilentlyContinue
            Set-Service -Name $_ -StartupType Disabled -ErrorAction SilentlyContinue
          }
          
          # Gi·∫£m lag RDP t·ªëi ƒëa
          New-Item -Path 'HKLM:\SOFTWARE\Policies\Microsoft\Windows NT\Terminal Services' -Force | Out-Null
          Set-ItemProperty -Path 'HKLM:\SOFTWARE\Policies\Microsoft\Windows NT\Terminal Services' -Name "MaxCompressionLevel" -Value 2 -Type DWord
          Set-ItemProperty -Path 'HKLM:\SOFTWARE\Policies\Microsoft\Windows NT\Terminal Services' -Name "VideoQualityMode" -Value 2 -Type DWord
          Set-ItemProperty -Path 'HKLM:\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp' -Name "fEnableDesktopComposition" -Value 0
          Set-ItemProperty -Path 'HKLM:\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations' -Name "DWMFRAMEINTERVAL" -Value 10 -Type DWord

      - name: Start Ngrok Tunnel (Hidden) & Display RDP Info
        run: |
          Write-Host "=================================================="
          Write-Host "NGUY·ªÑN CH√ç D·ª∞ WINDOWS THE FLASH - RDP S·∫¥N S√ÄNG!"
          Write-Host "T√™n ch·ªß: Nguy·ªÖn Ch√≠ D·ª±"
          Write-Host "Username: NguyenChiDu"
          Write-Host "Password: W1nd0ws-P4ssw0rd-2025!"
          Write-Host "Intro The Flash si√™u nhanh + Lag gi·∫£m max"
          Write-Host "=================================================="
          Write-Host "ƒêang kh·ªüi ƒë·ªông tunnel ngrok... (·∫©n c·ª≠a s·ªï)"
          
          Start-Process -WindowStyle Hidden -FilePath ".\ngrok.exe" -ArgumentList "tcp 3389 --log=stdout"
          
          Start-Sleep -Seconds 30
          
          $addr = ""
          for ($i = 1; $i -le 20; $i++) {
            try {
              $tunnels = Invoke-RestMethod http://localhost:4040/api/tunnels -ErrorAction Stop
              $addr = ($tunnels.tunnels | Where-Object { $_.proto -eq "tcp" }).public_url -replace "tc
