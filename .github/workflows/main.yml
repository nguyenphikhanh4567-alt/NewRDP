name: üöÄ M√ÅY CH·ª¶ PREMIUM C·ª¶A HEROGOODBOYVN üöÄ

on:
  workflow_dispatch:
    inputs:
      run_hours:
        description: 'Ch·ªçn th·ªùi gian ch·∫°y (1-6 gi·ªù)'
        required: true
        type: choice
        options: ['1', '2', '3', '4', '5', '6']
        default: '3'

- jobs:
  - M√ÅY CH·ª¶ PREMIUM C·ª¶A HEROGOODBOYVN:
    runs-on: windows-latest
    timeout-minutes: 390

    steps:
      - name: T·∫£i Ngrok (Latest stable - Direct exe, fix l·ªói t·∫£i 2026)
        run: |
          Invoke-WebRequest https://bin.equinox.io/a/nmkK7tSCK4A/ngrok-v3-stable-windows-amd64.exe -OutFile ngrok.exe
          .\ngrok.exe authtoken ${{ secrets.NGROK_AUTH_TOKEN }}

      - name: B·∫≠t RDP + T·∫°o User + T·ªëi ∆Øu Hi·ªáu Su·∫•t
        run: |
          Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server' -Name "fDenyTSConnections" -Value 0
          Enable-NetFirewallRule -DisplayGroup "Remote Desktop"

          $user = "HEROGOODBOYVN"
          $pass = "${{ secrets.RDP_PASSWORD || 'Nguyen2009' }}"

          if (-Not (Get-LocalUser -Name $user -ErrorAction SilentlyContinue)) {
            New-LocalUser -Name $user -Password (ConvertTo-SecureString $pass -AsPlainText -Force) -FullName "HEROGOODBOYVN Premium"
            Add-LocalGroupMember -Group "Administrators" -Member $user
            Add-LocalGroupMember -Group "Remote Desktop Users" -Member $user
          } else {
            Set-LocalUser -Name $user -Password (ConvertTo-SecureString $pass -AsPlainText -Force)
          }

          powercfg -setactive SCHEME_MIN
          Set-ItemProperty -Path 'HKCU:\Software\Microsoft\Windows\CurrentVersion\Themes\Personalize' -Name "EnableTransparency" -Value 0
          Set-ItemProperty -Path 'HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced' -Name "TaskbarAnimations" -Value 0
          Stop-Service SysMain, DiagTrack -Force -ErrorAction SilentlyContinue

      - name: Kh·ªüi ƒê·ªông Tunnel & Hi·ªÉn Th·ªã Th√¥ng Tin K·∫øt N·ªëi
        run: |
          Start-Process -WindowStyle Hidden -FilePath ".\ngrok.exe" -ArgumentList "tcp 3389"

          Write-Host "M√ÅY CH·ª¶ PREMIUM HEROGOODBOYVN ƒê√É ONLINE TH√ÄNH C√îNG!"
          Write-Host "Th·ªùi gian ch·∫°y: ${{ inputs.run_hours }} gi·ªù"

          Write-Host "ƒêang ch·ªù ngrok kh·ªüi t·∫°o tunnel (t·ª± ƒë·ªông retry n·∫øu c·∫ßn)..."

          Start-Sleep -Seconds 60

          $addr = ""
          for ($i = 1; $i -le 10; $i++) {
            try {
              $tunnel = Invoke-RestMethod http://localhost:4040/api/tunnels -ErrorAction Stop
              $addr = ($tunnel.tunnels | Where-Object proto -eq "tcp").public_url -replace "tcp://",""
              if ($addr) { 
                Write-Host "L·∫•y address th√†nh c√¥ng sau $i l·∫ßn th·ª≠!"
                break 
              }
            } catch {
              Write-Host "Retry l·∫ßn $i - ngrok ƒëang kh·ªüi ƒë·ªông..."
            }
            Start-Sleep -Seconds 30
          }

          if (-not $addr) {
            Write-Host "L·ªñI: Kh√¥ng l·∫•y ƒë∆∞·ª£c address sau 10 l·∫ßn th·ª≠ - Vui l√≤ng ki·ªÉm tra NGROK_AUTH_TOKEN!"
            exit 1
          }

          Write-Host "TH√îNG TIN K·∫æT N·ªêI (copy address b√™n d∆∞·ªõi):"
          Write-Host "$addr"
          Write-Host "Username: HEROGOODBOYVN"
          Write-Host "Password: ${{ secrets.RDP_PASSWORD || 'Nguyen2009' }}"
          Write-Host "Powered by HEROGOODBOYVN Premium"

          Start-Sleep -Seconds (${{ inputs.run_hours }} * 3600)
